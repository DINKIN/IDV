<html>
<head>
  <title>RAMADDA Data Model</title>
  <link rel="stylesheet" type="text/css" href="ramadda.css" title="Style">
</head>

<body>


The underlying data model follows a Composite pattern:
<ul>
<li> There are Entry and Group objects. 
<li> A Group <i>isa</i> Entry. 
<li> Groups can hold a number of children Entrys. 
<li> An Entry has a (single) parent Group.
</ul>

An Entry can represent a number of things. It may be a file on disk, an HTTP URL, an OpenDAP URL,
a weblog entry, a field project report, etc.
<p>
The only distinction between a Group and an Entry is that Groups are parents of Entrys. 
All other aspects of the data model are the same.

<p>

Below is the definition of the main entries database table. This represents the lowest 
common denominator  of metadata, e.g., name, group structure, type, time range, geobounds.
<table border=1>
<tr><td>id </td><td>varchar(200)</td>
<td>
The entry id. A unique identifier. See below for a discussion of Group ids.
</td></tr>

<tr><td>type </td><td>varchar(200)</td>
<td>
The entry type (e.g., group, file, model, etc). This corresponds to the TypeHandlers 
</td></tr>

<tr><td>name </td><td>varchar(200)</td>
<td>
Short name
</td></tr>
<tr><td>
description </td><td>varchar(2000)
</td><td>
Description
</td></tr>

<tr><td>parent_group_id </td><td>varchar(200)</td>
<td>
Parent group
</td></tr>

<tr><td>top_group_id </td><td>varchar(200)</td>
<td>
The group id of the second to last topmost group
</td></tr>

<tr><td>user_id </td><td>varchar(200)
</td><td>
the creator

<tr><td>resource </td><td>varchar(200)</td><td>
The resource path (e.g., file, url, etc)         
</td></tr>

<tr><td>resource_type </td><td>varchar(200)</td><td>
The type of the resource 
</td></tr>

<tr><td>datatype </td><td>varchar(200)</td><td>
allows for subtyping
</td></tr>

<tr><td>createdate</td><td> timestamp</td><td>
when it was created
</td></tr>
<tr><td>fromdate</td><td> timestamp</td><td> 
From date range of the data
</td></tr>

<tr><td>todate</td><td> timestamp</td><td>
To date range of the data
</td></tr>

<tr><td>south</td><td> float8</td><td>
Geo bounds
</td></tr>

<tr><td>north</td><td> float8</td><td>
Geo bounds
</td></tr>

<tr><td>east</td><td> float8</td><td>
Geo bounds
</td></tr>

<tr><td>west</td><td> float8 </td><td>
Geo bounds
</td></tr>
</table>


<h3>Entry and Group ids</h3>
Non-Group Entrys have a globally unique identifier generated by RAMADDA. However, Groups
have a special identifier that allow for searching under sub-groups. A Group identifier is
defined as:<pre>
&lt;parent Group identifier&gt;/&lt;sibling number&gt;
</pre>
For example, the top most group has identifier "0". Its children have identifiers:<pre>
0/0
0/1
0/2
...
</pre>
The children  of the 0/2 Group  have identifiers:<pre>
0/2/0
0/2/1
0/2/2
...
</pre>


This identifier structure is a bit awkward in that if we move Group trees we have to re-id the Groups. Also, we cannot just copy a set of Groups into a new RAMADDA repository.
We do this though because doing hierarchical searches in a relational  model is a bit sticky.
(e.g., see: <a href="http://www.codeproject.com/KB/database/HierarchicalDB3.aspx">How to manipulate hierarchical information in flat relational database tables</a>).
<p>
When we want to search under a particular Group subtree we use a wildcard on the parent id of the Entry. For example, say we are searching under the Group with id "0/2/0". The search would be:<pre>
select * from entries where entries.parent_group_id LIKE '0/2/0%'
</pre>






<h2>Metadata</h2>
Each Entry can have any  number of further Metadata elements. 
The Metadata table is shown below. 
Each Metadata element is managed by a MetadataHandler java class. This class is responsible
for showing the create/edit/search forms and for adding the metadata element into other content 
views (e.g., THREDDDS catalogs).  The MetadataHandler uses the attr(1-4) fields in the table to
hold the content. 
<p>
For example, the ThreddsMetadataHandler handles a variety  of metadata that 
shows up in THREDDS catalogs, e.g., creator, link, publisher, project. For each of these types
there is a metadata type in the table:  thredds.creator, thredds.link, etc. The attr(1-4) is used
to hold the content. For example, thredds.link type uses attr1 for the title and attr2 for the url.
The thredds.keyword just uses attr1 to hold the keyword. The thredds.publisher uses all 4 
attributes.


<table border=1>
<tr><td>id </td><td>varchar(200)</td><td>
The id of the metadata element
</td></tr>
<tr><td>			entry_id </td><td>varchar(200)</td><td>
The entry id. Corresponds to the id in the entries table above.
</td></tr>
<tr><td>                        type </td><td>varchar(200)</td><td>
The metadata type. This defines the MetadataHandler for this element.
</td></tr>
<tr><td>                        attr1 </td><td>varchar(10000)</td><td>
content 1
</td></tr>
<tr><td>                        attr2 </td><td>varchar(10000)</td><td>
content 2
</td></tr>
<tr><td>                        attr3 </td><td>varchar(10000)</td><td>
content 3
</td></tr>
<tr><td>                        attr4 </td><td>varchar(10000))</td><td>
content 4
</td></tr>

</table>

</body>
