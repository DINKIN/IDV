<?xml version="1.0" encoding="UTF-8"?>


<project basedir="../../../" default="all" name="Ramadda">


    <target name="init">
        <property  name="version" value="0.1"/>
        <property  name="build.sysclasspath" value="ignore"/>
        <property name="srcdir" value="${basedir}"/>
        <property name="compiledir" value="${srcdir}"/>
        <property name="srcversion" value="1.5"/>
        <property name="jars_dest" value="${basedir}/lib"/>
        <property name="libsrc" value="${basedir}/libsrc"/>
        <property name="libsdir" value="${jars_dest}"/>
        <property name="ramaddadir" value="${srcdir}/ucar/unidata/repository" />
        <property name="releasedir" value="${libsdir}/ramadda${version}" />
        <property name="tmpjardir" value="${libsdir}/tmpjardir" />
        <property name="xxxclasspath" value="${libsdir}/servlet-api.jar:${libsdir}/extra.jar:${libsdir}/external.jar"/>
        <property name="classpath" value="${libsdir}/servlet-api.jar:${libsdir}/extra.jar:${libsdir}/ramaddalib.jar:${libsdir}/tdsrepository.jar"/>
    </target>

    <target name="clean" depends="init" >
        <delete>
            <fileset dir="${compiledir}/ucar" includes="**/*.class"/>
        </delete>
    </target>


    <target name="all" depends="lib,ramaddajar,release,war">
    </target>


    <target name="compile" depends="init,clean">
        <javac
            classpath="${classpath}"
            debug="true"
            source="${srcversion}"
            deprecation="false" 
            destdir="${compiledir}"
            failonerror="${failonerror}" 
            nowarn="true"
            srcdir="${srcdir}"
        >
        <include name="ucar/unidata/repository/*.java"/>
        <include name="ucar/unidata/repository/idv/IdvWebstartOutputHandler.java"/>
        <include name="ucar/unidata/repository/idv/TdsOutputHandler.java"/>
        </javac>
    </target>

    <target name="ramaddajar" depends="compile">
        <jar 
            basedir="${srcdir}"
            compress="true"
            update="false"
            jarfile="${jars_dest}/ramadda.jar">
           <manifest>
              <attribute name="Implementation-Title" value="Unidata's Ramada"/>
              <attribute name="Implementation-Version" value="1.0"/>
              <attribute name="Implementation-Vendor" value="UCAR/Unidata"/>
              <attribute name="Main-class" value="ucar.unidata.repository.RepositoryServer"/>
              <attribute name="Class-Path" value="ramaddalib.jar idv.jar  jython.jar external.jar ncIdv.jar"/>
            </manifest> 
            <include name="ucar/**/*.class"/>
            <include name="ucar/unidata/repository/htdocs/**/*.*"/>
            <include name="ucar/unidata/repository/resources/**/*.*"/>
            <include name="ucar/unidata/repository/idv/template.jnlp"/>
            <include name="auxdata/maps/*"/>
            <include name="auxdata/ui/icons/*"/>
        </jar>
    </target>


    <target name="release" depends="init">
        <mkdir dir="${releasedir}"/>
        <delete includeemptydirs="true">
            <fileset dir="${releasedir}" includes="**/*"/>
        </delete>
        <copy  file="${libsdir}/ramadda.jar" todir="${releasedir}"/>
        <copy  file="${libsdir}/ramaddalib.jar" todir="${releasedir}"/>
        <copy  file="${ramaddadir}/release/ramadda.sh" todir="${releasedir}"/>
        <copy  file="${ramaddadir}/release/ramaddamysql.sh" todir="${releasedir}"/>
        <copy  file="${ramaddadir}/README" todir="${releasedir}"/>
        <delete file="${libsdir}/ramadda.tar"/>
        <tar 
            destfile="${libsdir}/ramadda.${version}.tar">
          <tarfileset dir="${releasedir}"
              prefix="ramadda${version}">
              <include name="*"/>
         </tarfileset>

        </tar>
<!--
        <delete includeemptydirs="true">
            <fileset dir="${releasedir}" includes="**/*"/>
        </delete>
-->
    </target>


    <target name="war" depends="init">
      <war webxml="${ramaddadir}/release/web.xml" destfile="${libsdir}/repository.war">
          <lib file="${libsdir}/ramadda.jar"/>
          <lib file="${libsdir}/ramaddalib.jar"/>
          <lib file="${libsdir}/tdsrepository.jar"/>
      </war>


    </target>


    <target name="lib" depends="init">
        <mkdir dir="${tmpjardir}"/>
        <delete includeemptydirs="true">
            <fileset dir="${tmpjardir}" includes="**/*"/>
        </delete>
        <unjar src="${jars_dest}/visad.jar" dest="${tmpjardir}"/>
        <unjar src="${jars_dest}/local-visad.jar" dest="${tmpjardir}"/>
        <unjar src="${libsdir}/extra.jar" dest="${tmpjardir}"/>
        <unjar src="${libsdir}/external.jar" dest="${tmpjardir}"/>

        <unjar src="${libsrc}/postgres.jar" dest="${tmpjardir}"/>
        <unjar src="${libsrc}/mysql.jar" dest="${tmpjardir}"/>
        <unjar src="${libsrc}/derby.jar" dest="${tmpjardir}"/>
        <unjar src="${libsrc}/derbytools.jar" dest="${tmpjardir}"/>
        <unjar src="${libsrc}/commons-io-1.4.jar" dest="${tmpjardir}"/>
        <unjar src="${libsrc}/commons-fileupload-1.2.1.jar" dest="${tmpjardir}"/>
        <jar 
            basedir="${tmpjardir}"
            compress="true"
            jarfile="${libsdir}/ramaddalib.jar">
              <include name="**"/>

        </jar>
        <delete dir="${tmpjardir}"/>
    </target>








</project>
